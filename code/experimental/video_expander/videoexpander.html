<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
    <style type="text/css">
        * {
            margin: 0; 
            padding: 0;
        }
        html, body {
            height: 100%;
        }
        .ad-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            background: #111;
            background-image: url('http://www.hardcoregaming101.net/wp-content/uploads/2017/09/hollowknight-9.jpg');
            background-size: cover;
            background-position: center center;
            overflow: hidden;
        }
        .expand-video {
            position: absolute;
            will-change: transform;
            width: 90%;
            top: 16px;;
            left: 16px;;
            transform: translate3d(0, 0, 0) scale(1);
            -webkit-transform: translate3d(0, 0, 0) scale(1);
            -webkit-backface-visibility: hidden;
            border: 2px solid white;
            transform-origin: 0 0;
            z-index: 1;
        }
        .logo {
            position: absolute;
            width: 60%;
            bottom: 8px;
            left: 14px;
            opacity: 0;
        }
        .character {
            position: absolute;
            right: 18px;
            width: 100px;
            transform: translateX(100px);
        }
    </style>
</head>
<body>
    <div class="ad-wrapper">
        <video class="expand-video" autoplay loop muted playsinline>
            <source src="assets/testvideo.mp4" type="video/mp4">
        </video>
        <img class="logo" src="http://hollowknight.com/wp-content/uploads/2015/08/logo_main.png" alt="">
        <img src="https://vignette.wikia.nocookie.net/blackbandos-homebrew/images/3/34/Hollow_knight_knight.png/revision/latest?cb=20180412151120" alt="" class="character">
    </div>
    <script type="text/javascript">
        (() => {
            const container = frameElement;
            const containerTop = container.offsetTop;
            const windowHeight = window.parent.window.innerHeight;

            const video = document.querySelector('.expand-video');
            const logo = document.querySelector('.logo');
            const character = document.querySelector('.character');

            let containerHeight;
            let firstIntersection = true;
            let minDistVal;

            let rAF = window.requestAnimationFrame;
            let lastScroll = -1;

            const map = (num, in_min, in_max, out_min, out_max) => {
                return (num - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
            }

            const adjustVideoSize = scrollPos => {
                if(scrollPos >= (containerTop + containerHeight)) {
                    let distFromTop = window.parent.window.pageYOffset - containerTop ;
                    let scaleVal = map(distFromTop, minDistVal, 0, 1, 0.6);
                    let logoOpacity = map(distFromTop, minDistVal, 0, 0, 1);
                    let characterTransform = map(distFromTop, minDistVal, 0, -100, 0);
                    video.style.transform = `translate3d(0, 0, 0) scale(${scaleVal})`;
                    logo.style.opacity = logoOpacity;
                    character.style.opacity = logoOpacity;
                    character.style.transform = `translate3d(${characterTransform}px,0,0)`;
                    if(firstIntersection) {
                        minDistVal = distFromTop;
                        firstIntersection = false;
                    }
                } else return false;
            }

            const loop = () => {
                if(lastScroll == window.parent.window.pageYOffset) {
                    rAF(loop);
                    return false;
                } else lastScroll = window.parent.window.pageYOffset;
                let scrollBottom = window.parent.window.pageYOffset + windowHeight;
                adjustVideoSize(scrollBottom);
                rAF(loop);
            }
            loop();

            adjustContainerSize = el => { el.style.width = '100%'; el.style.height = '250px'; containerHeight = container.getBoundingClientRect().height; }
            adjustContainerSize(container);
        })();
    </script>
</body>
</html>