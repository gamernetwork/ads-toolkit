<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Advanced JSON Editor Example</title>
	<style>
	</style>
	<script type="text/javascript" src="dist/jsoneditor.js"></script>
</head>

<body>
	<h1>Create Campaign JSON</h1>

	<button id='submit'>Submit (console.log)</button>
	<span id='valid_indicator'></span>

	<div id='editor_holder'></div>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		var socket = io.connect('localhost:3000');
		var request = new XMLHttpRequest();
		request.open('GET', 'json/testjson.json', true);
		request.onload = function () {
			if (request.status >= 200 && request.status < 400) {
				// Success!
				var data = JSON.parse(request.responseText);
				initEditor(data);
			} else {
				// We reached our target server, but it returned an error
			}
		};
		request.onerror = function () {
			// There was a connection error of some sort
		};
		request.send();

		function initEditor(data) {
			// Can Provide Prev JSON
			var starting_value = data;
			// Initialize the editor
			var editor = new JSONEditor(document.getElementById('editor_holder'), {
				// Enable fetching schemas via ajax
				ajax: true,
				theme: 'barebones',
				// The schema for the editor
				schema: {
					type: "array",
					title: "Campaigns",
					format: "tabs",
					items: {
						title: "Campaign",
						headerTemplate: "{{i}} - {{self.name}}",
						oneOf: [{
							$ref: "dist/campaign.json",
							title: "Campaign"
						}]
					}
				},
				// Seed the form with a starting value
				startval: starting_value,
				// Disable additional properties
				no_additional_properties: true,
				// Require all properties by default
				required_by_default: true
			});
			// Hook up the submit button to log to the console
			document.getElementById('submit').addEventListener('click', function () {
				// Get the value from the editor
				console.log(editor.getValue());
				socket.emit('message', editor.getValue());
			});
			// Hook up the validation indicator to update its 
			// status whenever the editor changes
			editor.on('change', function () {
				// Get an array of errors from the validator
				var errors = editor.validate();
				var indicator = document.getElementById('valid_indicator');
				// No valid
				if (errors.length) {
					indicator.style.color = 'red';
					indicator.textContent = "not valid";
				}
				// Valid
				else {
					indicator.style.color = 'green';
					indicator.textContent = "valid";
				}
			});
		}
	</script>
</body>

</html>