<html>
<head>
</head>
<body onload="init()">
<script>
!function(){for(var t=0,e=["ms","moz","webkit","o"],o=0;o<e.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[e[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[o]+"CancelAnimationFrame"]||window[e[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var o=(new Date).getTime(),n=Math.max(0,16-(o-t)),i=window.setTimeout(function(){e(o+n)},n);return t=o+n,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var CubeAd=function(t,e,o,n,i,r,s,u,a){this.init(t,e,o,n,i,r,s,u,a)};CubeAd.FPS=30,CubeAd.prototype.targetNode,CubeAd.prototype.cubeFaces,CubeAd.prototype.fallback,CubeAd.prototype.toyboxElement,CubeAd.prototype.cubeElement,CubeAd.prototype.parentBody,CubeAd.prototype.desktopSupported,CubeAd.prototype.cubeTransform,CubeAd.prototype.xDeg=0,CubeAd.prototype.yDeg=0,CubeAd.prototype.startX=0,CubeAd.prototype.startY=0,CubeAd.prototype.lockY=!1,CubeAd.prototype.currentAngleX=0,CubeAd.prototype.currentAngleY=0,CubeAd.prototype.currentTouchX=0,CubeAd.prototype.currentTouchY=0,CubeAd.prototype.currentDeltaY=0,CubeAd.prototype.currentDeltaX=0,CubeAd.prototype.oldDeltaY=0,CubeAd.prototype.oldDeltaX=0,CubeAd.prototype.momentumX=0,CubeAd.prototype.momentumY=0,CubeAd.prototype.startScrollY=0,CubeAd.prototype.lastScrollTop=0,CubeAd.prototype.touchStart=!1,CubeAd.prototype.touchEnd=!1,CubeAd.prototype.touching=!1,CubeAd.prototype.init=function(t,e,o,n,i,r,s,u,a){this.targetNode=t,this.cubeFaces=[],this.desktopSupported=a,this.parentBody=t.ownerDocument.getElementsByTagName("body")[0],this.buildCubeDOM(),this.checkTransformSupport()?(this.fallback.style.display="none",this.setFace(1,o),this.setFace(2,n),this.setFace(3,i),this.setFace(4,r),s&&this.setFace(0,s),u&&this.setFace(5,u),this.attachListeners(),this.lastScrollTop=this.parentBody.scrollTop,this.loop=this.loop.bind(this),this.loop()):this.setFallback(e)},CubeAd.prototype.buildCubeDOM=function(){this.fallback=document.createElement("div"),this.fallback.setAttribute("id","toybox-fallback"),this.fallback.setAttribute("style","width: 300px; margin-left: auto; margin-right: auto;");var t=document.createElement("div");t.setAttribute("id","toybox"),t.setAttribute("style","display: none;");var e=document.createElement("div");e.setAttribute("id","cube");for(var o=["one","two","three","four","five","six"],n=0;n<o.length;n++){var i=document.createElement("div");i.setAttribute("class","face "+o[n]),e.appendChild(i),this.cubeFaces.push(i)}t.appendChild(e),this.targetNode.appendChild(this.fallback),this.targetNode.appendChild(t),this.toyboxElement=t,this.cubeElement=e},CubeAd.prototype.setFace=function(t,e){if(cubeFace=this.cubeFaces[t],cubeFace.innerHTML="","object"==typeof e&&"nodeType"in e&&1===e.nodeType&&e.cloneNode)cubeFace.appendChild(e);else{if("string"!=typeof e)throw new Error("Unexpected face data");var o=document.createElement("img");o.src=e,cubeFace.appendChild(o)}},CubeAd.prototype.setFallback=function(t){if(this.fallback.innerHTML="","object"==typeof t&&"nodeType"in t&&1===t.nodeType&&t.cloneNode)fallback.appendChild(t);else{if("string"!=typeof t)throw new Error("Unexpected fallback data");var e=document.createElement("img");e.src=t,this.fallback.appendChild(e)}},CubeAd.prototype.getFaces=function(){return this.cubeFaces},CubeAd.prototype.getFace=function(t){return this.cubeFaces[t]},CubeAd.prototype.attachListeners=function(){this.onInteractStart=this.onInteractStart.bind(this),this.onInteractMove=this.onInteractMove.bind(this),this.onInteractEnd=this.onInteractEnd.bind(this),this.parentBody.addEventListener("touchstart",this.onInteractStart),this.parentBody.addEventListener("touchmove",this.onInteractMove),this.parentBody.addEventListener("touchend",this.onInteractEnd),this.desktopSupported&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.desktopSupported=!1:(this.parentBody.addEventListener("click",this.onInteractStart),this.parentBody.addEventListener("mousemove",this.onInteractMove),this.parentBody.addEventListener("mouseup",this.onInteractEnd)))},CubeAd.prototype.checkTransformSupport=function(){this.cubeTransform=null;for(var t=["webkitTransform","msTransform","transform"],e=0;e<t.length;e++)if(t[e]in this.cubeElement.style)return this.cubeTransform=t[e],this.cubeTransform;return this.cubeTransform},CubeAd.prototype.onInteractStart=function(t){if(!this.touching&&!this.touchEnd){if(!this.getY(t))return;var e=this.toyboxElement.getBoundingClientRect(),o=this.parentBody.getBoundingClientRect();this.checkBounds(this.getX(t),this.getY(t),e.left,e.top-o.top,e.right,e.bottom-o.top)&&(this.startX=this.getX(t),this.startY=this.getY(t),this.currentTouchX=this.getX(t),this.currentTouchY=this.getY(t),this.currentDeltaX=0,this.currentDeltaY=0,this.oldDeltaX=0,this.oldDeltaY=0,this.touchStart=!0)}},CubeAd.prototype.onInteractMove=function(t){if(this.touching&&!this.touchEnd){if(!this.getY(t))return;this.currentTouchX=this.getX(t),this.currentTouchY=this.getY(t);var e=this.toyboxElement.getBoundingClientRect(),o=this.parentBody.getBoundingClientRect();this.checkBounds(this.currentTouchX,this.currentTouchY,e.left,e.top-o.top,e.right,e.bottom-o.top)?this.lockY||t.preventDefault():this.touchEnd=!0}},CubeAd.prototype.onInteractEnd=function(){this.touching&&(this.touchEnd=!0)},CubeAd.prototype.update=function(){Math.abs(this.parentBody.scrollTop-this.startScrollY)>10&&this.touching&&(this.touchEnd=!0,this.oldDeltaX=0,this.currentDeltaX=0),this.touchEnd&&(this.momentumX=.8*(this.oldDeltaX-this.currentDeltaX),this.momentumY=0,this.oldDeltaY=0,this.yDeg=0,this.touching=!1,this.touchEnd=!1),this.touching&&this.calculateNewAngle(),this.touchStart&&(this.currentAngleX=this.xDeg,this.currentAngleY=this.yDeg,this.momentumX=0,this.momentumY=0,this.startScrollY=this.parentBody.scrollTop,this.touching=!0,this.touchStart=!1),this.touching||(this.xDeg+=.02*(this.lastScrollTop-this.parentBody.scrollTop),this.lastScrollTop=this.parentBody.scrollTop),0!=Math.round(this.momentumX)&&(this.xDeg-=this.momentumX,this.momentumX*=.9)},CubeAd.prototype.draw=function(){this.cubeElement.style[this.cubeTransform]=this.lockY?"rotateX(0deg) rotateY("+this.xDeg+"deg)":"rotateX("+this.yDeg+"deg) rotateY("+this.xDeg+"deg)"},CubeAd.prototype.loop=function(){var t=this;setTimeout(function(){requestAnimationFrame(t.loop),t.update(),t.draw()},1e3/CubeAd.FPS)},CubeAd.prototype.calculateNewAngle=function(){var t=this.currentTouchX,e=this.currentTouchY;this.oldDeltaY=this.currentDeltaY,this.oldDeltaX=this.currentDeltaX,this.currentDeltaY=e-this.startY,this.currentDeltaX=t-this.startX,this.xDeg=this.currentAngleX+.5*this.currentDeltaX,this.yDeg=this.currentAngleY+.4*-this.currentDeltaY},CubeAd.prototype.checkBounds=function(t,e,o,n,i,r){return t>o&&e>n&&r>e&&i>t?!0:!1},CubeAd.prototype.setLockY=function(t){this.lockY=t},CubeAd.prototype.getX=function(t){return this.desktopSupported?t.clientX+document.body.scrollLeft:t.changedTouches?t.changedTouches[0].pageX:null},CubeAd.prototype.getY=function(t){return this.desktopSupported?t.clientY+document.body.scrollTop:t.changedTouches?t.changedTouches[0].pageY:null};var DFPCubeAd=function(t,e,o,n,i,r,s,u,a){this.init(t,e,o,n,i,r,s,u,a)};DFPCubeAd.prototype=Object.create(CubeAd.prototype),DFPCubeAd.prototype.__super__=CubeAd,DFPCubeAd.prototype.init=function(t,e,o,n,i,r,s,u,a){this.__super__.prototype.init.call(this,t,e,o,n,i,r,s,u,a),this.checkTransformSupport()&&(this.appendStyleSheet(),this.setMobileMPUSize()),window.frameElement.style.height="0",window.frameElement.style.marginBottom="0px"},DFPCubeAd.prototype.appendStyleSheet=function(){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href","//images.eurogamer.net/2014/toybox/toybox-style.css?v=1"),parent.document.getElementsByTagName("head")[0].appendChild(t)},DFPCubeAd.prototype.setMobileMPUSize=function(){parent.document.getElementById("mobile-mpu").style.width="100%"};
    
        var cubeAd;
        var youtubeEmbed;
        var mainFace;
        var buyFace;
        var galleryShowing = false;
        function init()
        {
            var styleSheet = document.createElement("link");
            styleSheet.setAttribute("rel", "stylesheet");
            styleSheet.setAttribute("type", "text/css");
            styleSheet.setAttribute("href", "//images.eurogamer.net/2014/toybox/assets/video-js/video-js.min.css");
            parent.document.getElementsByTagName("head")[0].appendChild(styleSheet);
            
            var videoScript = document.createElement("script");
            videoScript.onload = loadCube;
            videoScript.src = "//images.eurogamer.net/2014/toybox/assets/video-js/video.js";
            parent.document.getElementsByTagName("head")[0].appendChild(videoScript);
        }
        function loadCube()
        {
            mainFace = createFace("//images.eurogamer.net/2014/toybox/assets/image.png", "https://minecraft.net/");
            buyFace = createFace("//images.eurogamer.net/2014/toybox/tests/buy.jpg", "https://play.google.com/store/apps/details?id=com.mojang.minecraftpe&hl=en_GB");
            
            //targetNode, face1 (front), face2, face3, face4, face5 (top), face6 (bottom), desktopSupport true/false
            //Faces can also be DOM elements
            youtubeEmbed = document.createElement('div');
            youtubeEmbed.innerHTML = '<video id="ad_video" src="//images.eurogamer.net/2014/toybox/minecraft/Minecraft-Trailer.m4v" width="256" height="256" controls class="video-js vjs-default-skin" poster="//images.eurogamer.net/2014/toybox/minecraft/1.jpg"></video>';
            
            cubeAd = new DFPCubeAd(window.frameElement.parentElement, "//images.eurogamer.net/2014/toybox/assets/image.png", mainFace, "//images.eurogamer.net/2014/toybox/tests/2-gallery.jpg", youtubeEmbed, buyFace, null, null, true);
            cubeAd.setLockY(true);
            
            cubeAd.getFace(2).addEventListener("click", setGallery);
            
            parent.videojs("ad_video", {}, function(){
            });
        }
        function setGallery()
        {
            if(galleryShowing)
            {
                cubeAd.setFace(1, mainFace);
                cubeAd.setFace(2, "//images.eurogamer.net/2014/toybox/tests/2-gallery.jpg");
                cubeAd.setFace(3, youtubeEmbed);
                cubeAd.setFace(4, buyFace);
                galleryShowing = false;
            }
            else
            {
                cubeAd.setFace(1, "//images.eurogamer.net/2014/toybox/minecraft/1.jpg");
                cubeAd.setFace(2, "//images.eurogamer.net/2014/toybox/tests/2-gallery-close.jpg");
                cubeAd.setFace(3, "//images.eurogamer.net/2014/toybox/minecraft/3.jpg");
                cubeAd.setFace(4, "//images.eurogamer.net/2014/toybox/minecraft/4.jpg");
                galleryShowing = true;
            }
        }
        function createFace(imgURL, link)
        {
            var img = document.createElement('img');
            img.setAttribute("src", imgURL);
            
            var anchor = document.createElement('a');
            anchor.setAttribute("href", link);
            anchor.setAttribute("target", "_blank");
            
            anchor.appendChild(img);
            return anchor;
        }
        </script>
</body>
</html>
