!function(){for(var t=0,e=["ms","moz","webkit","o"],o=0;o<e.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[e[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[o]+"CancelAnimationFrame"]||window[e[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var o=(new Date).getTime(),i=Math.max(0,16-(o-t)),r=window.setTimeout(function(){e(o+i)},i);return t=o+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var CubeAd=function(t,e,o,i,r,s,n){this.init(t,e,o,i,r,s,n)};CubeAd.FPS=30,CubeAd.prototype.targetNode,CubeAd.prototype.cubeFaces,CubeAd.prototype.fallback,CubeAd.prototype.toyboxElement,CubeAd.prototype.cubeElement,CubeAd.prototype.parentBody,CubeAd.prototype.desktopSupported,CubeAd.prototype.cubeTransform,CubeAd.prototype.xDeg=0,CubeAd.prototype.yDeg=0,CubeAd.prototype.startX=0,CubeAd.prototype.startY=0,CubeAd.prototype.lockY=!1,CubeAd.prototype.currentAngleX=0,CubeAd.prototype.currentAngleY=0,CubeAd.prototype.currentTouchX=0,CubeAd.prototype.currentTouchY=0,CubeAd.prototype.currentDeltaY=0,CubeAd.prototype.currentDeltaX=0,CubeAd.prototype.oldDeltaY=0,CubeAd.prototype.oldDeltaX=0,CubeAd.prototype.momentumX=0,CubeAd.prototype.momentumY=0,CubeAd.prototype.startScrollY=0,CubeAd.prototype.lastScrollTop=0,CubeAd.prototype.touchStart=!1,CubeAd.prototype.touchEnd=!1,CubeAd.prototype.touching=!1,CubeAd.prototype.init=function(t,e,o,i,r,s,n){this.targetNode=t,this.cubeFaces=[],this.desktopSupported=n,this.parentBody=t.ownerDocument.getElementsByTagName("body")[0],this.buildCubeDOM(),this.checkTransformSupport()?(this.fallback.style.display="none",this.setFace(1,o),this.setFace(2,i),this.setFace(3,r),this.setFace(4,s),this.attachListeners(),this.lastScrollTop=this.parentBody.scrollTop,this.loop=this.loop.bind(this),this.loop()):this.setFallback(e)},CubeAd.prototype.buildCubeDOM=function(){this.fallback=document.createElement("div"),this.fallback.setAttribute("id","toybox-fallback"),this.fallback.setAttribute("style","width: 300px; margin-left: auto; margin-right: auto;");var t=document.createElement("div");t.setAttribute("id","toybox"),t.setAttribute("style","display: none;");var e=document.createElement("div");e.setAttribute("id","cube");for(var o=["one","two","three","four","five","six"],i=0;i<o.length;i++){var r=document.createElement("div");r.setAttribute("class","face "+o[i]),e.appendChild(r),this.cubeFaces.push(r)}t.appendChild(e),this.targetNode.appendChild(this.fallback),this.targetNode.appendChild(t),this.toyboxElement=t,this.cubeElement=e},CubeAd.prototype.setFace=function(t,e){cubeFace=this.cubeFaces[t],this.setNode(cubeFace,e)},CubeAd.prototype.setFallback=function(t){this.setNode(this.fallback,t)},CubeAd.prototype.setNode=function(t,e){if(t.innerHTML="",wrapper=document.createElement("div"),e.hasOwnProperty("dom")){var o=e.dom;if("object"==typeof o&&"nodeType"in o&&1===o.nodeType&&o.cloneNode)wrapper.appendChild(o);else{if("string"!=typeof o)throw new Error("Unexpected DOM data");wrapper.innerHTML=o}}else{if(!e.hasOwnProperty("img"))throw new Error("Unexpected face object");if(e.hasOwnProperty("url")){var i=document.createElement("img");i.setAttribute("src",e.img);var r=document.createElement("a");r.setAttribute("href",e.url),r.setAttribute("target","_blank"),r.appendChild(i),wrapper.appendChild(r)}else{var s=document.createElement("img");s.src=e.img,wrapper.appendChild(s)}}t.appendChild(wrapper)},CubeAd.prototype.getFaces=function(){return this.cubeFaces},CubeAd.prototype.getFace=function(t){return this.cubeFaces[t]},CubeAd.prototype.attachListeners=function(){this.onInteractStart=this.onInteractStart.bind(this),this.onInteractMove=this.onInteractMove.bind(this),this.onInteractEnd=this.onInteractEnd.bind(this),this.parentBody.addEventListener("touchstart",this.onInteractStart),this.parentBody.addEventListener("touchmove",this.onInteractMove),this.parentBody.addEventListener("touchend",this.onInteractEnd),this.desktopSupported&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.desktopSupported=!1:(this.parentBody.addEventListener("click",this.onInteractStart),this.parentBody.addEventListener("mousemove",this.onInteractMove),this.parentBody.addEventListener("mouseup",this.onInteractEnd)))},CubeAd.prototype.checkTransformSupport=function(){this.cubeTransform=null;for(var t=["webkitTransform","msTransform","transform"],e=0;e<t.length;e++)if(t[e]in this.cubeElement.style)return this.cubeTransform=t[e],this.cubeTransform;return this.cubeTransform},CubeAd.prototype.onInteractStart=function(t){if(!this.touching&&!this.touchEnd){if(null==this.getY(t))return;var e=this.toyboxElement.getBoundingClientRect(),o=this.parentBody.getBoundingClientRect();this.checkBounds(this.getX(t),this.getY(t),e.left,e.top-o.top,e.right,e.bottom-o.top)&&(this.startX=this.getX(t),this.currentTouchX=this.getX(t),this.lockY||(this.startY=this.getY(t),this.currentTouchY=this.getY(t)),this.currentDeltaX=0,this.currentDeltaY=0,this.oldDeltaX=0,this.oldDeltaY=0,this.touchStart=!0)}},CubeAd.prototype.onInteractMove=function(t){if(this.touching&&!this.touchEnd){if(null==this.getY(t))return;this.currentTouchX=this.getX(t),this.lockY||(this.currentTouchY=this.getY(t));var e=this.toyboxElement.getBoundingClientRect(),o=this.parentBody.getBoundingClientRect();this.checkBounds(this.currentTouchX,this.getY(t),e.left,e.top-o.top,e.right,e.bottom-o.top)?this.lockY||t.preventDefault():this.touchEnd=!0}},CubeAd.prototype.onInteractEnd=function(){this.touching&&(this.touchEnd=!0)},CubeAd.prototype.update=function(){Math.abs(this.parentBody.scrollTop-this.startScrollY)>10&&this.touching&&(this.oldDeltaX=0,this.currentDeltaX=0,this.touchEnd=!0),this.touchEnd&&(this.momentumX=.8*(this.oldDeltaX-this.currentDeltaX),0==this.lockY?this.momentumY=.8*(this.oldDeltaY-this.currentDeltaY):(this.momentumY=0,this.oldDeltaY=0,this.yDeg=0),this.touching=!1,this.touchEnd=!1),this.touching&&this.calculateNewAngle(),this.touchStart&&(this.currentAngleX=this.xDeg,this.currentAngleY=this.yDeg,this.momentumX=0,this.momentumY=0,this.startScrollY=this.parentBody.scrollTop,this.touching=!0,this.touchStart=!1),this.touching||(this.xDeg+=.05*(this.lastScrollTop-this.parentBody.scrollTop),this.lastScrollTop=this.parentBody.scrollTop),0!=Math.round(this.momentumX)&&(this.xDeg-=this.momentumX,this.momentumX*=.9),0!=Math.round(this.momentumY)&&(this.yDeg+=this.momentumY,this.momentumY*=.9)},CubeAd.prototype.draw=function(){this.cubeElement.style[this.cubeTransform]="rotateX("+this.yDeg+"deg) rotateY("+this.xDeg+"deg)"},CubeAd.prototype.loop=function(){var t=this;setTimeout(function(){requestAnimationFrame(t.loop),t.update(),t.draw()},1e3/CubeAd.FPS)},CubeAd.prototype.calculateNewAngle=function(){var t=this.currentTouchX,e=this.currentTouchY;this.oldDeltaY=this.currentDeltaY,this.oldDeltaX=this.currentDeltaX,this.currentDeltaY=e-this.startY,this.currentDeltaX=t-this.startX,this.xDeg=this.currentAngleX+.5*this.currentDeltaX,this.yDeg=this.currentAngleY+.4*-this.currentDeltaY},CubeAd.prototype.checkBounds=function(t,e,o,i,r,s){return t>o&&e>i&&s>e&&r>t?!0:!1},CubeAd.prototype.setLockY=function(t){this.lockY=t,t?this.cubeElement.getElementsByClassName("face one")[0]&&this.cubeElement.getElementsByClassName("face six")[0]&&(this.cubeElement.removeChild(this.cubeElement.getElementsByClassName("face one")[0]),this.cubeElement.removeChild(this.cubeElement.getElementsByClassName("face six")[0])):(this.cubeElement.appendChild(this.cubeFaces[0]),this.cubeElement.appendChild(this.cubeFaces[5]))},CubeAd.prototype.getX=function(t){return this.desktopSupported?t.clientX+document.body.scrollLeft:t.changedTouches?t.changedTouches[0].pageX:null},CubeAd.prototype.getY=function(t){return this.desktopSupported?t.clientY+document.body.scrollTop:t.changedTouches?t.changedTouches[0].pageY:null};var DFPCubeAd=function(t,e,o,i,r,s,n){this.init(t,e,o,i,r,s,n)};DFPCubeAd.prototype=Object.create(CubeAd.prototype),DFPCubeAd.prototype.__super__=CubeAd,DFPCubeAd.prototype.init=function(t,e,o,i,r,s,n){this.__super__.prototype.init.call(this,t,e,o,i,r,s,n),this.checkTransformSupport()&&(this.appendStyleSheet(),this.setAdNotice(t),this.setMobileMPUSize()),window.frameElement.style.height="0",window.frameElement.style.marginBottom="0px"},DFPCubeAd.prototype.appendStyleSheet=function(){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href","//images.eurogamer.net/2014/ads/toybox/toybox-style.css?v=0.82"),parent.document.getElementsByTagName("head")[0].appendChild(t)},DFPCubeAd.prototype.setAdNotice=function(t){var e=document.createElement("p");e.setAttribute("id","toybox-ad-notice"),e.setAttribute("style","display: none;"),e.textContent="ADVERTISEMENT",t.insertBefore(e,t.firstChild)},DFPCubeAd.prototype.setMobileMPUSize=function(){parent.document.getElementById("mobile-mpu").style.width="100%"};var DFPPortraitCubeAd=function(t,e,o,i,r,s,n){this.init(t,e,o,i,r,s,n)};DFPPortraitCubeAd.prototype=Object.create(DFPCubeAd.prototype),DFPPortraitCubeAd.prototype.___super__=DFPCubeAd,DFPPortraitCubeAd.prototype.faceObjs,DFPPortraitCubeAd.prototype.fullyLoaded,DFPPortraitCubeAd.prototype.init=function(t,e,o,i,r,s,n){var a=[],h=[];for(this.faceObjs=[o,i,r,s],this.fullyLoaded=!1,d=0;d<this.faceObjs.length;d++)if(this.faceObjs[d].hasOwnProperty("video")){if(!this.faceObjs[d].video.hasOwnProperty("url"))throw new Error("Missing a video URL");a.push("video_face_"+d),this.faceObjs[d]={dom:this.buildVideoDOM("video_face_"+d,this.faceObjs[d].video.url,this.faceObjs[d].video.poster)}}else if(this.faceObjs[d].hasOwnProperty("gallery")){if(!this.faceObjs[d].gallery.hasOwnProperty("galleryPoster"))throw new Error("Missing a gallery poster");for(var c=1;5>c;c++)if(!this.faceObjs[d].gallery.hasOwnProperty("face"+c))throw new Error("Missing gallery image "+c);this.faceObjs[d].gallery.index=d,h.push(this.faceObjs[d].gallery),this.faceObjs[d]=this.faceObjs[d].gallery.galleryPoster}this.___super__.prototype.init.call(this,t,e,this.faceObjs[0],this.faceObjs[1],this.faceObjs[2],this.faceObjs[3],n);for(var u=this,d=0;d<h.length;d++){var l=this.getFace(h[d].index+1);l.showingGallery=!1,l.gallery=h[d],l.addEventListener("click",function(t){u.onGalleryClick(t)})}a.length>0?this.loadVideoScripts(a):this.finishLoad()},DFPPortraitCubeAd.prototype.onGalleryClick=function(t){if(t.stopPropagation(),this.fullyLoaded){var e=t.currentTarget;t.currentTarget.showingGallery?(this.setFace(1,this.faceObjs[0]),this.setFace(2,this.faceObjs[1]),this.setFace(3,this.faceObjs[2]),this.setFace(4,this.faceObjs[3]),e.showingGallery=!1):(this.setFace(1,e.gallery.face1),this.setFace(2,e.gallery.face2),this.setFace(3,e.gallery.face3),this.setFace(4,e.gallery.face4),e.showingGallery=!0)}},DFPPortraitCubeAd.prototype.buildVideoDOM=function(t,e,o){var i=document.createElement("video");return i.setAttribute("id",t),i.setAttribute("src",e),o&&i.setAttribute("poster",o),i.setAttribute("width","200"),i.setAttribute("height","200"),i.setAttribute("controls","true"),i.setAttribute("class","video-js vjs-default-skin"),i},DFPPortraitCubeAd.prototype.loadVideoScripts=function(t){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","//images.eurogamer.net/2014/toybox/assets/video-js/video-js.min.css"),parent.document.getElementsByTagName("head")[0].appendChild(e);var o=document.createElement("script"),i=this;o.onload=function(){i.findVideos(t)},o.src="//images.eurogamer.net/2014/toybox/assets/video-js/video.js",parent.document.getElementsByTagName("head")[0].appendChild(o)},DFPPortraitCubeAd.prototype.findVideos=function(t){for(var e=0;e<t.length;e++)parent.videojs(t[e],{},function(){});this.finishLoad()},DFPPortraitCubeAd.prototype.finishLoad=function(){this.faceObjs[0]={dom:this.getFace(1).firstChild},this.faceObjs[1]={dom:this.getFace(2).firstChild},this.faceObjs[2]={dom:this.getFace(3).firstChild},this.faceObjs[3]={dom:this.getFace(4).firstChild},this.fullyLoaded=!0};