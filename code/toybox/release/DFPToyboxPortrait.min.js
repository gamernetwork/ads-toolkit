(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());var CubeAd=function(c,g,a,f,d,b,e){this.init(c,g,a,f,d,b,e)};CubeAd.prototype.TB_VERSION=0.84;CubeAd.prototype.DEBUG=false;CubeAd.FPS=30;CubeAd.prototype.targetNode;CubeAd.prototype.cubeFaces;CubeAd.prototype.fallback;CubeAd.prototype.toyboxElement;CubeAd.prototype.cubeElement;CubeAd.prototype.parentBody;CubeAd.prototype.desktopSupported;CubeAd.prototype.cubeTransform;CubeAd.prototype.xDeg=0;CubeAd.prototype.yDeg=0;CubeAd.prototype.startX=0;CubeAd.prototype.startY=0;CubeAd.prototype.lockY=false;CubeAd.prototype.currentAngleX=0;CubeAd.prototype.currentAngleY=0;CubeAd.prototype.currentTouchX=0;CubeAd.prototype.currentTouchY=0;CubeAd.prototype.currentDeltaY=0;CubeAd.prototype.currentDeltaX=0;CubeAd.prototype.oldDeltaY=0;CubeAd.prototype.oldDeltaX=0;CubeAd.prototype.momentumX=0;CubeAd.prototype.momentumY=0;CubeAd.prototype.startScrollY=0;CubeAd.prototype.lastScrollTop=0;CubeAd.prototype.touchStart=false;CubeAd.prototype.touchEnd=false;CubeAd.prototype.touching=false;CubeAd.prototype.momentumContinued=false;CubeAd.prototype.isInteracted=false;CubeAd.prototype.init=function(c,g,a,f,d,b,e){this.targetNode=c;this.cubeFaces=[];this.desktopSupported=e;this.parentBody=c.ownerDocument.getElementsByTagName("body")[0];this.buildCubeDOM();if(this.checkTransformSupport()){this.fallback.style.display="none";this.setFace(1,a);this.setFace(2,f);this.setFace(3,d);this.setFace(4,b);this.attachListeners();this.lastScrollTop=this.parentBody.scrollTop;this.loop=this.loop.bind(this);this.loop()}else{this.setFallback(g)}};CubeAd.prototype.buildCubeDOM=function(){this.fallback=document.createElement("div");this.fallback.setAttribute("id","toybox-fallback");this.fallback.setAttribute("style","width: 300px; margin-left: auto; margin-right: auto;");var e=document.createElement("div");e.setAttribute("id","toybox");e.setAttribute("style","display: none;");var a=document.createElement("div");a.setAttribute("id","cube");var b=["one","two","three","four","five","six"];for(var c=0;c<b.length;c++){var d=document.createElement("div");d.setAttribute("class","face "+b[c]);a.appendChild(d);this.cubeFaces.push(d)}e.appendChild(a);this.targetNode.appendChild(this.fallback);this.targetNode.appendChild(e);this.toyboxElement=e;this.cubeElement=a};CubeAd.prototype.setFace=function(b,a){cubeFace=this.cubeFaces[b];this.setNode(cubeFace,a)};CubeAd.prototype.setFallback=function(a){this.setNode(this.fallback,a)};CubeAd.prototype.setNode=function(e,c){e.innerHTML="";wrapper=document.createElement("div");wrapper.setAttribute("class","toybox-face-wrapper");if(c.hasOwnProperty("dom")){var f=c.dom;if(typeof f=="object"&&"nodeType" in f&&f.nodeType===1&&f.cloneNode){wrapper.appendChild(f)}else{if(typeof f=="string"){wrapper.innerHTML=f}else{throw new Error("Unexpected DOM data")}}}else{if(c.hasOwnProperty("img")){if(c.hasOwnProperty("url")){var a=document.createElement("img");a.setAttribute("src",c.img);var b=document.createElement("a");b.setAttribute("href",c.url);b.setAttribute("target","_blank");b.appendChild(a);wrapper.appendChild(b)}else{var d=document.createElement("img");d.src=c.img;wrapper.appendChild(d)}}else{throw new Error("Unexpected face object")}}e.appendChild(wrapper)};CubeAd.prototype.getFaces=function(){return this.cubeFaces};CubeAd.prototype.getFace=function(a){return this.cubeFaces[a]};CubeAd.prototype.attachListeners=function(){this.onInteractStart=this.onInteractStart.bind(this);this.onInteractMove=this.onInteractMove.bind(this);this.onInteractEnd=this.onInteractEnd.bind(this);this.parentBody.addEventListener("touchstart",this.onInteractStart);this.parentBody.addEventListener("touchmove",this.onInteractMove);this.parentBody.addEventListener("touchend",this.onInteractEnd);if(this.desktopSupported){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){this.desktopSupported=false}else{this.parentBody.addEventListener("click",this.onInteractStart);this.parentBody.addEventListener("mousemove",this.onInteractMove);this.parentBody.addEventListener("mouseup",this.onInteractEnd)}}};CubeAd.prototype.checkTransformSupport=function(){this.cubeTransform=null;var b=["webkitTransform","msTransform","transform"];for(var a=0;a<b.length;a++){if(b[a] in this.cubeElement.style){this.cubeTransform=b[a];return this.cubeTransform}}return this.cubeTransform};CubeAd.prototype.onInteractStart=function(c){this.cubeElement.setAttribute("class","");this.momentumContinued=false;if(!this.touching){if(!this.touchEnd){if(this.getY(c)==null){return}var b=this.toyboxElement.getBoundingClientRect();var a=this.parentBody.getBoundingClientRect();if(this.checkBounds(this.getX(c),this.getY(c),b.left,b.top-a.top,b.right,b.bottom-a.top)){this.startX=this.getX(c);this.currentTouchX=this.getX(c);if(!this.lockY){this.startY=this.getY(c);this.currentTouchY=this.getY(c)}this.currentDeltaX=0;this.currentDeltaY=0;this.oldDeltaX=0;this.oldDeltaY=0;this.touchStart=true}}}};CubeAd.prototype.onInteractMove=function(c){this.draw();if(this.touching){if(!this.touchEnd){if(this.getY(c)==null){return}this.currentTouchX=this.getX(c);if(!this.lockY){this.currentTouchY=this.getY(c)}var b=this.toyboxElement.getBoundingClientRect();var a=this.parentBody.getBoundingClientRect();if(this.checkBounds(this.currentTouchX,this.getY(c),b.left,b.top-a.top,b.right,b.bottom-a.top)){if(!this.lockY){c.preventDefault()}}else{this.touchEnd=true}}}};CubeAd.prototype.onInteractEnd=function(a){if(this.touching){this.touchEnd=true}};CubeAd.prototype.update=function(){if(Math.abs(this.parentBody.scrollTop-this.startScrollY)>30){if(this.touching){this.oldDeltaX=0;this.currentDeltaX=0;this.touchEnd=true}}if(this.touchEnd){this.momentumX=(this.oldDeltaX-this.currentDeltaX)*0.8;if(this.momentumX==0){this.roundCube()}if(this.lockY==false){this.momentumY=(this.oldDeltaY-this.currentDeltaY)*0.8}else{this.momentumY=0;this.oldDeltaY=0;this.yDeg=0}this.touching=false;this.touchEnd=false}if(this.touching){this.calculateNewAngle()}if(this.touchStart){this.currentAngleX=this.xDeg;this.currentAngleY=this.yDeg;this.momentumX=0;this.momentumY=0;this.startScrollY=this.parentBody.scrollTop;this.touching=true;this.touchStart=false}if(!this.isInteracted){if(Math.abs(this.currentDeltaX)>3){this.isInteracted=true}if(!this.touching){this.xDeg+=(this.lastScrollTop-this.parentBody.scrollTop)*0.05;this.lastScrollTop=this.parentBody.scrollTop}}if(Math.round(this.momentumX)!=0){this.xDeg-=this.momentumX;this.momentumX*=0.9;this.momentumContinued=true}else{if(this.momentumContinued){this.roundCube();this.momentumContinued=false}}if(Math.round(this.momentumY)!=0){this.yDeg+=this.momentumY;this.momentumY*=0.9}};CubeAd.prototype.roundCube=function(){this.xDeg=90*(Math.round(this.xDeg/90));this.cubeElement.setAttribute("class","anim-cube")};CubeAd.prototype.draw=function(){this.cubeElement.style[this.cubeTransform]="rotateX("+this.yDeg+"deg) rotateY("+this.xDeg+"deg)"};CubeAd.prototype.loop=function(){var a=this;setTimeout(function(){requestAnimationFrame(a.loop);a.update();a.draw()},1000/CubeAd.FPS)};CubeAd.prototype.calculateNewAngle=function(){var b=this.currentTouchX;var a=this.currentTouchY;this.oldDeltaY=this.currentDeltaY;this.oldDeltaX=this.currentDeltaX;this.currentDeltaY=a-this.startY;this.currentDeltaX=b-this.startX;this.xDeg=this.currentAngleX+(this.currentDeltaX*0.5);this.yDeg=this.currentAngleY+((-this.currentDeltaY)*0.4)};CubeAd.prototype.checkBounds=function(a,f,e,d,c,b){if(a>e&&f>d&&f<b&&a<c){return true}return false};CubeAd.prototype.setLockY=function(a){this.lockY=a;if(a){if(this.cubeElement.getElementsByClassName("face one")[0]&&this.cubeElement.getElementsByClassName("face six")[0]){this.cubeElement.removeChild(this.cubeElement.getElementsByClassName("face one")[0]);this.cubeElement.removeChild(this.cubeElement.getElementsByClassName("face six")[0])}}else{this.cubeElement.appendChild(this.cubeFaces[0]);this.cubeElement.appendChild(this.cubeFaces[5])}};CubeAd.prototype.getX=function(a){if(this.desktopSupported){return a.clientX+document.body.scrollLeft}else{if(!a.changedTouches){return null}return a.changedTouches[0].pageX}};CubeAd.prototype.getY=function(a){if(this.desktopSupported){return a.clientY+document.body.scrollTop}else{if(!a.changedTouches){return null}return a.changedTouches[0].pageY}};var DFPCubeAd=function(c,g,a,f,d,b,e){this.init(c,g,a,f,d,b,e)};DFPCubeAd.prototype=Object.create(CubeAd.prototype);DFPCubeAd.prototype.__super__=CubeAd;DFPCubeAd.prototype.init=function(c,g,a,f,d,b,e){this.__super__.prototype.init.call(this,c,g,a,f,d,b,e);if(this.checkTransformSupport()){this.appendStyleSheet();this.setAdNotice(c);this.setMobileMPUSize()}window.frameElement.style.height="0";window.frameElement.style.marginBottom="0px"};DFPCubeAd.prototype.appendStyleSheet=function(){var a=document.createElement("link");a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");if(this.DEBUG){a.setAttribute("href","../src/css/toybox-style.css")}else{a.setAttribute("href","//images.eurogamer.net/2014/ads/toybox/toybox.min.css?v="+this.TB_VERSION)}parent.document.getElementsByTagName("head")[0].appendChild(a)};DFPCubeAd.prototype.setAdNotice=function(a){var b=document.createElement("p");b.setAttribute("id","toybox-ad-notice");b.setAttribute("style","display: none;");b.textContent="ADVERTISEMENT";a.insertBefore(b,a.firstChild)};DFPCubeAd.prototype.setMobileMPUSize=function(){parent.document.getElementById("mobile-mpu").style.width="100%"};var DFPPortraitCubeAd=function(c,g,a,f,d,b,e){this.init(c,g,a,f,d,b,e)};DFPPortraitCubeAd.prototype=Object.create(DFPCubeAd.prototype);DFPPortraitCubeAd.prototype.___super__=DFPCubeAd;DFPPortraitCubeAd.prototype.faceObjs;DFPPortraitCubeAd.prototype.fullyLoaded;DFPPortraitCubeAd.prototype.init=function(j,f,b,a,n,m,g){var l=[];var c=[];this.faceObjs=[b,a,n,m];this.fullyLoaded=false;for(e=0;e<this.faceObjs.length;e++){if(this.faceObjs[e].hasOwnProperty("video")){if(this.faceObjs[e].video.hasOwnProperty("url")){l.push("video_face_"+e);this.faceObjs[e]={dom:this.buildVideoDOM("video_face_"+e,this.faceObjs[e].video.url,this.faceObjs[e].video.poster)}}else{throw new Error("Missing a video URL")}}else{if(this.faceObjs[e].hasOwnProperty("gallery")){if(this.faceObjs[e].gallery.hasOwnProperty("galleryPoster")){for(var k=1;k<5;k++){if(!this.faceObjs[e].gallery.hasOwnProperty("face"+k)){throw new Error("Missing gallery image "+k)}}this.faceObjs[e].gallery.index=e;c.push(this.faceObjs[e].gallery);this.faceObjs[e]=this.faceObjs[e].gallery.galleryPoster}else{throw new Error("Missing a gallery poster")}}}}this.___super__.prototype.init.call(this,j,f,this.faceObjs[0],this.faceObjs[1],this.faceObjs[2],this.faceObjs[3],g);var h=this;for(var e=0;e<c.length;e++){var d=this.getFace(c[e].index+1);d.showingGallery=false;d.gallery=c[e];d.addEventListener("click",function(i){h.onGalleryClick(i)})}if(l.length>0){this.loadVideoScripts(l)}else{this.finishLoad()}};DFPPortraitCubeAd.prototype.onGalleryClick=function(b){b.stopPropagation();if(!this.fullyLoaded){return}var a=b.currentTarget;if(b.currentTarget.showingGallery){this.setFace(1,this.faceObjs[0]);this.setFace(2,this.faceObjs[1]);this.setFace(3,this.faceObjs[2]);this.setFace(4,this.faceObjs[3]);a.showingGallery=false}else{this.setFace(1,a.gallery.face1);this.setFace(2,a.gallery.face2);this.setFace(3,a.gallery.face3);this.setFace(4,a.gallery.face4);a.showingGallery=true}};DFPPortraitCubeAd.prototype.buildVideoDOM=function(d,c,a){var b=document.createElement("video");b.setAttribute("id",d);b.setAttribute("src",c);if(a){b.setAttribute("poster",a)}b.setAttribute("width","254");b.setAttribute("height","210");b.setAttribute("controls","true");b.setAttribute("preload","none");b.setAttribute("class","video-js vjs-default-skin");return b};DFPPortraitCubeAd.prototype.loadVideoScripts=function(d){var c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href","//images.eurogamer.net/2014/toybox/assets/video-js/video-js.min.css");parent.document.getElementsByTagName("head")[0].appendChild(c);var a=document.createElement("script");var b=this;a.onload=function(f){b.findVideos(d)};a.src="//images.eurogamer.net/2014/toybox/assets/video-js/video.js";parent.document.getElementsByTagName("head")[0].appendChild(a)};DFPPortraitCubeAd.prototype.findVideos=function(b){for(var a=0;a<b.length;a++){parent.videojs(b[a],{},function(){})}this.finishLoad()};DFPPortraitCubeAd.prototype.finishLoad=function(){this.faceObjs[0]={dom:this.getFace(1).firstChild};this.faceObjs[1]={dom:this.getFace(2).firstChild};this.faceObjs[2]={dom:this.getFace(3).firstChild};this.faceObjs[3]={dom:this.getFace(4).firstChild};this.fullyLoaded=true};