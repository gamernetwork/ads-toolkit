<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Campaign Editor</title>
	<script type="text/javascript" src="dist/jsoneditor.js"></script>
	<!-- Foundation CSS framework (Bootstrap and jQueryUI also supported) -->
	<link rel='stylesheet' href='//cdn.jsdelivr.net/foundation/5.0.2/css/foundation.min.css'>
	<!-- Font Awesome icons (Bootstrap, Foundation, and jQueryUI also supported) -->
	<link rel='stylesheet' href='//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css'>
	<style>
			h1 {
				text-align: center;
				margin: 2rem;
			}
			button {
				margin-left: .5rem;
			}
			#editor_holder {
				display: block;
				width: 960px;
				margin: 2rem auto;
				
			}
			#submit {
				display: block;
				clear: both;
				display: block;
				left: 50%;
				transform: translateX(-50%);
				background: none;
				color: #333;
				border: 2px solid #0079A1;
			}
			.panel {
				min-width: 600px;
			}
			#valid_indicator {
				font-size: 1rem;
				margin-left: 1rem;
			}
		</style>
	<script>
		// Set the default CSS theme and icon library globally
		JSONEditor.defaults.theme = 'foundation5';
		JSONEditor.defaults.iconlib = 'fontawesome4';
	</script>
</head>

<body>
	<h1>Campaign Manager</h1>
	<button id='submit'>Update Campaigns<span id='valid_indicator'></span></button>
	<div id='editor_holder'></div>
	
	
	<script src="/socket.io/socket.io.js"></script>
	<script>
		var socket = io.connect('localhost:3000');
		var request = new XMLHttpRequest();
		request.open('GET', 'json/testjson.json', true);
		request.onload = function () {
			if (request.status >= 200 && request.status < 400) {
				// Success!
				var data = JSON.parse(request.responseText);
				initEditor(data);
			} else {
				// We reached our target server, but it returned an error
			}
		};
		request.onerror = function () {
			// There was a connection error of some sort
		};
		request.send();

		function initEditor(data) {
			// Can Provide Prev JSON
			var starting_value = data;
			// Initialize the editor
			var editor = new JSONEditor(document.getElementById('editor_holder'), {
				// Enable fetching schemas via ajax
				ajax: true,
				disable_collapse: true,
				disable_array_delete: true,
				disable_array_reorder: true,
				disable_edit_json: true,
				disable_properties: true,
				// The schema for the editor
				schema: {
					type: "array",
					title: "Campaigns",
					format: "tabs",
					items: {
						title: "Campaign",
						headerTemplate: "{{self.name}}",
						oneOf: [{
							$ref: "dist/campaign.json",
							title: "Campaign"
						}]
					}
				},
				// Seed the form with a starting value
				startval: starting_value,
				// Disable additional properties
				no_additional_properties: true,
				// Require all properties by default
				required_by_default: true
			});
			// Hook up the submit button to log to the console
			document.getElementById('submit').addEventListener('click', function () {
				// Get the value from the editor
				console.log(editor.getValue());
				socket.emit('message', editor.getValue());
			});
			// Hook up the validation indicator to update its 
			// status whenever the editor changes
			editor.on('change', function () {
				// Get an array of errors from the validator
				var errors = editor.validate();
				var indicator = document.getElementById('valid_indicator');
				// No valid
				if (errors.length) {
					indicator.style.color = 'red';
					indicator.textContent = "not valid";
				}
				// Valid
				else {
					indicator.style.color = 'green';
					indicator.textContent = "valid";
				}
			});
			// document.querySelector('.button-group').appendChild(submitButton);
			editor.on('ready', function(){

			});
		}
	</script>
</body>

</html>